<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests TMS Quick Actions - CapinIA</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 0 auto; padding: 20px; }
        .test-case { border: 1px solid #ccc; margin: 15px 0; padding: 15px; border-radius: 8px; }
        .test-case.pass { border-color: #28a745; background: linear-gradient(135deg, #d4edda, #c3e6cb); }
        .test-case.fail { border-color: #dc3545; background: linear-gradient(135deg, #f8d7da, #f5c6cb); }
        .test-case.pending { border-color: #ffc107; background: linear-gradient(135deg, #fff3cd, #ffeaa7); }
        
        .status { font-weight: bold; font-size: 14px; }
        .pass { color: #28a745; }
        .fail { color: #dc3545; }
        .pending { color: #e67e22; }
        
        .code { background: #2d3748; color: #f7fafc; padding: 12px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 13px; overflow-x: auto; }
        .inline-code { background: #e2e8f0; color: #2d3748; padding: 2px 6px; border-radius: 4px; font-family: monospace; }
        
        .button { background: linear-gradient(135deg, #4299e1, #3182ce); color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin: 5px; font-weight: 500; transition: all 0.2s; }
        .button:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3); }
        .button.fail-btn { background: linear-gradient(135deg, #f56565, #e53e3e); }
        .button.fail-btn:hover { box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3); }
        
        h1 { color: #2d3748; text-align: center; margin-bottom: 10px; }
        h2 { color: #4a5568; border-bottom: 2px solid #e2e8f0; padding-bottom: 5px; }
        h3 { color: #2b6cb0; margin-top: 0; }
        h4 { color: #4a5568; margin-bottom: 8px; }
        
        .summary { background: linear-gradient(135deg, #bee3f8, #90cdf4); padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0; }
        .icon { display: inline-block; margin-right: 8px; }
        
        .step { background: #f7fafc; border-left: 4px solid #4299e1; padding: 10px 15px; margin: 8px 0; }
        .expected { background: #f0fff4; border-left: 4px solid #38a169; padding: 10px 15px; margin: 8px 0; }
        
        ul li { margin: 5px 0; }
        .highlight { background: #fef5e7; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üöÄ Tests TMS Quick Actions</h1>
    <div class="summary">
        <h2>üìä Estado de Implementaci√≥n</h2>
        <div>
            <span class="icon">üìÅ</span>Componentes: TmsQuickActions, CourseCodeModal, tmsPrompts<br>
            <span class="icon">üîó</span>Integraci√≥n: CapinChat.tsx<br>
            <span class="icon">‚ö°</span>Atajos: Ctrl+K para R11<br>
            <span class="icon">üíæ</span>Persistencia: localStorage para √∫ltimo c√≥digo<br>
        </div>
    </div>

    <div class="test-case pending" id="test-1">
        <h3>üéØ Test 1: Visibilidad Condicional por Rol</h3>
        <div class="status pending">üü° PENDIENTE</div>
        
        <h4>Objetivo:</h4>
        <p>Verificar que el panel "Acciones TMS" solo aparece para roles <span class="inline-code">tms:*</span></p>
        
        <h4>Pasos:</h4>
        <div class="step">
            <strong>1.</strong> Abrir CapinIA chat en: <a href="http://localhost:8081" target="_blank">http://localhost:8081</a>
        </div>
        <div class="step">
            <strong>2.</strong> Seleccionar rol "P√∫blico" en el dropdown
        </div>
        <div class="step">
            <strong>3.</strong> Verificar que <strong>NO aparece</strong> el panel "Acciones TMS"
        </div>
        <div class="step">
            <strong>4.</strong> Cambiar rol a "TMS" ‚Üí seleccionar √°rea "Log√≠stica" 
        </div>
        <div class="step">
            <strong>5.</strong> Verificar que <strong>S√ç aparece</strong> el panel con 4 botones coloridos
        </div>
        
        <div class="expected">
            <h4>‚úÖ Resultado Esperado:</h4>
            <ul>
                <li>Panel TMS ausente con rol "P√∫blico"</li>
                <li>Panel TMS presente con rol "TMS" + √°rea</li>
                <li>4 botones: R11 (azul), R12 (verde), R61 (naranja), Bloques (morado)</li>
                <li>Tag "Modo TMS ‚Ä¢ Ctrl+K para R11" encima del input</li>
            </ul>
        </div>
        
        <button class="button" onclick="markTest('test-1', 'pass')">‚úÖ PASS</button>
        <button class="button fail-btn" onclick="markTest('test-1', 'fail')">‚ùå FAIL</button>
    </div>

    <div class="test-case pending" id="test-2">
        <h3>üìù Test 2: Modal y Validaci√≥n de C√≥digo</h3>
        <div class="status pending">üü° PENDIENTE</div>
        
        <h4>Objetivo:</h4>
        <p>Verificar que el modal captura y valida c√≥digos correctamente</p>
        
        <h4>Pasos:</h4>
        <div class="step">
            <strong>1.</strong> Con rol TMS activo, hacer click en "Consultar R11"
        </div>
        <div class="step">
            <strong>2.</strong> Verificar que el modal se abre con t√≠tulo "Consultar R11"
        </div>
        <div class="step">
            <strong>3.</strong> Escribir c√≥digo inv√°lido: <span class="inline-code">abc123</span>
        </div>
        <div class="step">
            <strong>4.</strong> Verificar mensaje de error y bot√≥n deshabilitado
        </div>
        <div class="step">
            <strong>5.</strong> Escribir c√≥digo v√°lido: <span class="inline-code">ES-COM-1352</span>
        </div>
        <div class="step">
            <strong>6.</strong> Verificar que bot√≥n se habilita y error desaparece
        </div>
        <div class="step">
            <strong>7.</strong> Presionar Enter o click "Consultar"
        </div>
        
        <div class="expected">
            <h4>‚úÖ Resultado Esperado:</h4>
            <ul>
                <li>Modal con t√≠tulo e icono correctos</li>
                <li>Validaci√≥n en tiempo real</li>
                <li>Bot√≥n habilitado/deshabilitado seg√∫n validez</li>
                <li>Modal se cierra tras confirmar</li>
                <li>Mensaje enviado al chat</li>
            </ul>
        </div>
        
        <button class="button" onclick="markTest('test-2', 'pass')">‚úÖ PASS</button>
        <button class="button fail-btn" onclick="markTest('test-2', 'fail')">‚ùå FAIL</button>
    </div>

    <div class="test-case pending" id="test-3">
        <h3>ü§ñ Test 3: Prompt Expl√≠cito Generado</h3>
        <div class="status pending">üü° PENDIENTE</div>
        
        <h4>Objetivo:</h4>
        <p>Verificar que se genera y env√≠a el prompt correcto al backend</p>
        
        <h4>Pasos:</h4>
        <div class="step">
            <strong>1.</strong> Abrir DevTools ‚Üí pesta√±a Network
        </div>
        <div class="step">
            <strong>2.</strong> Filtrar por "chat" en Network
        </div>
        <div class="step">
            <strong>3.</strong> Consultar R11 para c√≥digo "P-OPE-1012"
        </div>
        <div class="step">
            <strong>4.</strong> Inspeccionar el request POST en Network
        </div>
        <div class="step">
            <strong>5.</strong> Verificar el JSON payload completo</strong>
        </div>
        
        <div class="expected">
            <h4>‚úÖ Payload Esperado:</h4>
            <div class="code">
{
  "message": "Solicito expl√≠citamente la informaci√≥n del R11 para el codigoCurso: P-OPE-1012. Entrega:\n- Relator creador del R11 (nombre completo)\n- Objetivo general\n- Poblaci√≥n objetivo\n- Contenidos espec√≠ficos R11 (lista con horasT y horasP)\n- Nota m√≠nima (si existe)\n- Horas te√≥ricas, horas pr√°cticas y total\nUsa √∫nicamente la entidad kb_curso que haga match por data.codigoCurso y no mezcles con otros cursos.",
  "role": "tms:log√≠stica",
  "session_id": "&lt;uuid&gt;",
  "user": {
    "role": "tms:log√≠stica",
    "session_id": "&lt;uuid&gt;",
    "tenantId": "insecap"
  }
}
            </div>
            
            <h4>Console Logs Esperados:</h4>
            <div class="code">
[TMS ACTION] R11 para curso: P-OPE-1012
[TMS PROMPT] Solicito expl√≠citamente la informaci√≥n del R11...
Chat request received - role: tms:log√≠stica, raw_role: undefined, session_id: &lt;uuid&gt;, message: Solicito expl√≠citamente...
            </div>
        </div>
        
        <button class="button" onclick="markTest('test-3', 'pass')">‚úÖ PASS</button>
        <button class="button fail-btn" onclick="markTest('test-3', 'fail')">‚ùå FAIL</button>
    </div>

    <div class="test-case pending" id="test-4">
        <h3>üíæ Test 4: Autocompletado LocalStorage</h3>
        <div class="status pending">üü° PENDIENTE</div>
        
        <h4>Objetivo:</h4>
        <p>Verificar persistencia del √∫ltimo c√≥digo usado</p>
        
        <h4>Pasos:</h4>
        <div class="step">
            <strong>1.</strong> Consultar R12 con c√≥digo "ES-COM-1352"
        </div>
        <div class="step">
            <strong>2.</strong> Abrir DevTools Console y ejecutar: <span class="inline-code">localStorage.getItem('tms_last_course_code')</span>
        </div>
        <div class="step">
            <strong>3.</strong> Verificar que retorna "ES-COM-1352"
        </div>
        <div class="step">
            <strong>4.</strong> Abrir cualquier modal TMS (ej: Consultar R61)
        </div>
        <div class="step">
            <strong>5.</strong> Verificar que el input tiene pre-cargado "ES-COM-1352"
        </div>
        
        <div class="expected">
            <h4>‚úÖ Resultado Esperado:</h4>
            <ul>
                <li>localStorage guarda el √∫ltimo c√≥digo usado</li>
                <li>Pr√≥ximos modals TMS autocompletan con ese c√≥digo</li>
                <li>Facilita consultas repetidas del mismo curso</li>
            </ul>
        </div>
        
        <button class="button" onclick="markTest('test-4', 'pass')">‚úÖ PASS</button>
        <button class="button fail-btn" onclick="markTest('test-4', 'fail')">‚ùå FAIL</button>
    </div>

    <div class="test-case pending" id="test-5">
        <h3>‚å®Ô∏è Test 5: Atajo Ctrl+K</h3>
        <div class="status pending">üü° PENDIENTE</div>
        
        <h4>Objetivo:</h4>
        <p>Verificar que Ctrl+K abre directamente el modal R11</p>
        
        <h4>Pasos:</h4>
        <div class="step">
            <strong>1.</strong> Con rol TMS activo, presionar <span class="highlight">Ctrl+K</span>
        </div>
        <div class="step">
            <strong>2.</strong> Verificar que se abre el modal "Consultar R11"
        </div>
        <div class="step">
            <strong>3.</strong> Cambiar rol a "P√∫blico"
        </div>
        <div class="step">
            <strong>4.</strong> Presionar Ctrl+K nuevamente
        </div>
        <div class="step">
            <strong>5.</strong> Verificar que NO se abre el modal (solo funciona con TMS)
        </div>
        
        <div class="expected">
            <h4>‚úÖ Resultado Esperado:</h4>
            <ul>
                <li>Ctrl+K funciona solo con roles TMS</li>
                <li>Abre espec√≠ficamente modal R11</li>
                <li>Input del modal tiene foco autom√°tico</li>
            </ul>
        </div>
        
        <button class="button" onclick="markTest('test-5', 'pass')">‚úÖ PASS</button>
        <button class="button fail-btn" onclick="markTest('test-5', 'fail')">‚ùå FAIL</button>
    </div>

    <div class="test-case pending" id="test-6">
        <h3>üîÑ Test 6: Los 4 Tipos de Consulta</h3>
        <div class="status pending">üü° PENDIENTE</div>
        
        <h4>Objetivo:</h4>
        <p>Verificar que cada bot√≥n genera el prompt espec√≠fico correcto</p>
        
        <h4>Pasos:</h4>
        <div class="step">
            <strong>1.</strong> Probar cada bot√≥n con c√≥digo "P-OPE-1012":<br>
            ‚Ä¢ Consultar R11 ‚Üí verificar prompt R11<br>
            ‚Ä¢ Consultar R12 ‚Üí verificar prompt R12<br>
            ‚Ä¢ Consultar R61 ‚Üí verificar prompt R61<br>
            ‚Ä¢ Consultar Bloques ‚Üí verificar prompt Bloques
        </div>
        <div class="step">
            <strong>2.</strong> En cada caso, revisar Console logs y Network payload
        </div>
        
        <div class="expected">
            <h4>‚úÖ Templates Esperados:</h4>
            <ul>
                <li><strong>R11:</strong> "Relator creador del R11", "Objetivo general", "Contenidos espec√≠ficos R11"</li>
                <li><strong>R12:</strong> "Costos R12 desglosados", "Observaciones relevantes"</li>
                <li><strong>R61:</strong> "Registros R61 disponibles", "Contenidos espec√≠ficos R61"</li>
                <li><strong>Bloques:</strong> "Lista de bloques con fecha", "horarioInicio, horarioTermino", "Relator por bloque"</li>
            </ul>
        </div>
        
        <button class="button" onclick="markTest('test-6', 'pass')">‚úÖ PASS</button>
        <button class="button fail-btn" onclick="markTest('test-6', 'fail')">‚ùå FAIL</button>
    </div>

    <div class="summary" id="summary">
        <h2>üìä Resumen de Tests</h2>
        <p>Total: 6 tests | <span class="pending" id="pending-count">6 Pendientes</span> | <span class="pass" id="pass-count">0 Pasaron</span> | <span class="fail" id="fail-count">0 Fallaron</span></p>
    </div>

    <h2>üõ†Ô∏è Debugging Utils</h2>
    <div class="code">
// Verificar localStorage
localStorage.getItem('tms_last_course_code')

// Limpiar localStorage para test desde cero
localStorage.removeItem('tms_last_course_code')

// Verificar rol actual (debe empezar con 'tms:')
// En el chat, cambiar rol y observar si aparece/desaparece panel

// Probar validaci√≥n de c√≥digos
// V√°lidos: ES-COM-1352, P-OPE-1012, EA-TEC-001
// Inv√°lidos: abc, 123, ES-COM, COM-1352

// Ver payload completo en Network ‚Üí chat ‚Üí Request body
    </div>

    <script>
        let testResults = {
            'test-1': 'pending',
            'test-2': 'pending', 
            'test-3': 'pending',
            'test-4': 'pending',
            'test-5': 'pending',
            'test-6': 'pending'
        };

        function markTest(testId, result) {
            testResults[testId] = result;
            
            const testElement = document.getElementById(testId);
            const statusElement = testElement.querySelector('.status');
            
            testElement.className = 'test-case ' + result;
            
            if (result === 'pass') {
                statusElement.innerHTML = '<span class="pass">‚úÖ PASS</span>';
                statusElement.className = 'status pass';
            } else if (result === 'fail') {
                statusElement.innerHTML = '<span class="fail">‚ùå FAIL</span>';
                statusElement.className = 'status fail';
            }
            
            updateSummary();
        }

        function updateSummary() {
            const pending = Object.values(testResults).filter(r => r === 'pending').length;
            const pass = Object.values(testResults).filter(r => r === 'pass').length;
            const fail = Object.values(testResults).filter(r => r === 'fail').length;
            
            document.getElementById('pending-count').textContent = `${pending} Pendientes`;
            document.getElementById('pass-count').textContent = `${pass} Pasaron`;
            document.getElementById('fail-count').textContent = `${fail} Fallaron`;
        }

        // Logging inicial
        console.log('=== TMS Quick Actions Tests ===');
        console.log('Frontend URL: http://localhost:8081');
        console.log('Verificar localStorage:', localStorage.getItem('tms_last_course_code'));
        console.log('Roles TMS v√°lidos: tms:coordinador, tms:log√≠stica, tms:postcurso, etc.');
    </script>
</body>
</html>